/* --- START OF FILE main.css --- */

/* 1. Define CSS Variables (Light Theme Defaults) */
:root {
    --bg-color: #f8f9fa;                 /* Light gray page background */
    --text-color: #202124;               /* Dark text */
    --text-secondary-color: #5f6368;     /* Lighter text (titles, placeholders) */
    --primary-accent: #1a73e8;           /* Blue accent (buttons, links) */
    --primary-accent-text: white;        /* Text on primary accent */
    --primary-accent-hover: #185abc;     /* Hover for primary accent */
    --border-color: #dfe1e5;             /* Input borders, separators */
    --card-bg: white;                    /* Chat container background */
    --card-shadow: rgba(0, 0, 0, 0.05);
    --bubble-bg-assistant: #f1f3f4;      /* Assistant message background */
    --bubble-text-assistant: #202124;    /* Text in assistant bubble */
    --bubble-bg-user: #e8f0fe;           /* User message background (light blue) */
    --bubble-text-user: #174ea6;         /* User message text (darker blue) */
    --bubble-shadow: rgba(0, 0, 0, 0.1);
    --button-secondary-bg: #f1f3f4;      /* Reset button, Suggestion button bg */
    --button-secondary-text: #1a73e8;    /* Suggestion button text */
    --button-secondary-text-alt: #5f6368; /* Reset button text color */
    --button-secondary-hover-bg: #e8f0fe; /* Suggestion button hover */
    --link-color: #1a73e8;                /* Markdown links */
    --code-bg: #f1f3f4;                  /* Code block background */
    --code-text: #202124;                /* Code text color */
    --code-font: 'Roboto Mono', monospace;/* Code font family */
    --table-header-bg: #f1f3f4;          /* Table header */
    --table-border-color: #e0e0e0;        /* Table borders */
    --header-bg: #f8f9fa;                /* Header background */
    --header-shadow: rgba(0, 0, 0, 0.1);  /* Subtle shadow */
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-medium: rgba(0, 0, 0, 0.2);
    --spinner-color: var(--primary-accent);
    --spinner-track-color: var(--shadow-light);
    --spinner-on-button-color: var(--primary-accent-text);
    --spinner-on-button-track-color: rgba(255, 255, 255, 0.3);
  }
  
  /* 3. Define Dark Theme Overrides */
  html[data-theme="dark"] {
    /* Define dark theme variables */
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --text-secondary-color: #a0a0a0;
    --primary-accent: #64b5f6;
    --primary-accent-text: #121212;
    --primary-accent-hover: #82c2ff;
    --border-color: #555;
    --card-bg: #1e1e1e;
    --card-shadow: rgba(0, 0, 0, 0.4);
    --bubble-bg-assistant: #292929;
    --bubble-text-assistant: #e0e0e0;
    --bubble-bg-user: #0e3658; /* Dark blue user bubble */
    --bubble-text-user: #e0e0e0;
    --bubble-shadow: rgba(0, 0, 0, 0.4);
    --button-secondary-bg: #3a414d;
    --button-secondary-text: #64b5f6;
    --button-secondary-text-alt: #e0e0e0;
    --button-secondary-hover-bg: #4f5864;
    --link-color: #64b5f6;
    --code-bg: #2b2b2b;
    --code-text: #e0e0e0;
    --table-header-bg: #2d2d2d;
    --table-border-color: #555;
    --header-bg: #1a1a1a;
    --header-shadow: rgba(0, 0, 0, 0.4);
    --shadow-light: rgba(0, 0, 0, 0.3);
    --shadow-medium: rgba(0, 0, 0, 0.4);
    --spinner-color: var(--primary-accent);
    --spinner-track-color: rgba(255, 255, 255, 0.1);
    --spinner-on-button-color: var(--primary-accent-text);
    --spinner-on-button-track-color: rgba(0, 0, 0, 0.3);
  }
  /* Specificity for dark mode body */
  html[data-theme="dark"] body {
    background-color: var(--bg-color) !important;
    color: var(--text-color) !important;
  }
  
  /* 4. System Preference Media Query */
  @media (prefers-color-scheme: dark) {
    html[data-theme="system"] body {
        background-color: var(--bg-color) !important;
        color: var(--text-color) !important;
    }
    html[data-theme="system"] {
      /* Apply all dark theme variables here as overrides */
      --bg-color: #121212; --text-color: #e0e0e0; --text-secondary-color: #a0a0a0;
      --primary-accent: #64b5f6; --primary-accent-text: #121212; --primary-accent-hover: #82c2ff;
      --border-color: #555; --card-bg: #1e1e1e; --card-shadow: rgba(0, 0, 0, 0.4);
      --bubble-bg-assistant: #292929; --bubble-text-assistant: #e0e0e0; --bubble-bg-user: #0e3658;
      --bubble-text-user: #e0e0e0; --bubble-shadow: rgba(0, 0, 0, 0.4);
      --button-secondary-bg: #3a414d; --button-secondary-text: #64b5f6; --button-secondary-text-alt: #e0e0e0;
      --button-secondary-hover-bg: #4f5864; --link-color: #64b5f6; --code-bg: #2b2b2b;
      --code-text: #e0e0e0; --table-header-bg: #2d2d2d; --table-border-color: #555;
      --header-bg: #1a1a1a; --header-shadow: rgba(0, 0, 0, 0.4); --shadow-light: rgba(0, 0, 0, 0.3);
      --shadow-medium: rgba(0, 0, 0, 0.4); --spinner-color: var(--primary-accent);
      --spinner-track-color: rgba(255, 255, 255, 0.1); --spinner-on-button-color: var(--primary-accent-text);
      --spinner-on-button-track-color: rgba(0, 0, 0, 0.3);
    }
  }
  
  /* --- Base Styles --- */
  html { height: 100%; transition: background-color 0.3s, color 0.3s; }
  body {
      background-color: var(--bg-color) !important; /* Ensure base applies */
      color: var(--text-color) !important;          /* Ensure base applies */
      font-family: 'Google Sans', 'Segoe UI', system-ui, -apple-system, sans-serif;
      margin: 0; padding: 0; min-height: 100vh; height: auto;
      transition: background-color 0.2s, color 0.2s;
  }
  
  /* === HEADER AND LOGO (Manual Div Structure) === */
  .logo-container {
      background-color: var(--header-bg);
      padding: 10px 20px;
      box-shadow: 0 1px 3px var(--header-shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      position: sticky; top: 0; z-index: 1000;
  }
  .header-logo { height: 35px; width: auto; display: block; } /* Use block */
  
  /* --- Header Controls (Container for Buttons) --- */
  .header-controls {
      display: flex;
      align-items: center;
      /* gap: 10px; */ /* <<< REMOVED - Use margin instead */
      position: relative; /* For dropdown positioning */
      z-index: 10;
      flex-wrap: nowrap;
      min-width: 0;
  }
  
  /* Style Icon Buttons WITHIN Header Controls specifically */
  .header-controls > .icon-button {
      background: none !important; border: none !important;
      padding: 5px; cursor: pointer; font-size: 1.5rem;
      color: var(--text-secondary-color) !important; /* Ensure color */
      line-height: 1; border-radius: 4px; transition: background-color 0.2s;
      display: flex; align-items: center; justify-content: center;
      width: 36px; height: 36px;
  }
  .header-controls > .icon-button:hover {
      background-color: var(--button-secondary-hover-bg) !important;
  }
  
  /* *** ADD MARGIN FOR SPACING *** */
  .header-controls > #theme-toggle {
      margin-right: 10px; /* Adjust as needed */
  }
  
  /* Keep menu toggle and hamburger styles */
  .menu-toggle { display: flex; flex-direction: column; gap: 4px; width: 24px; height: 24px; justify-content: center; }
  .hamburger-bar { display: block; height: 2px; width: 100%; background-color: var(--text-secondary-color); border-radius: 1px; }
  
  /* Settings Dropdown Menu */
  .settings-menu {
      display: none; position: absolute; top: 100%; right: 0; /* Position relative to .header-controls */
      background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 6px;
      box-shadow: 0 4px 12px var(--card-shadow); min-width: 150px; z-index: 1010; margin-top: 5px;
  }
  .settings-menu.visible { display: block; }
  .settings-menu ul { list-style: none; margin: 0; padding: 5px 0; }
  .settings-menu li a { display: block; padding: 8px 15px; color: var(--text-color); text-decoration: none; white-space: nowrap; cursor: pointer; }
  .settings-menu li a:hover { background-color: var(--button-secondary-hover-bg); }
  .settings-menu li a.active-theme { font-weight: bold; }
  
  
  /* === MAIN CONTENT AREA & CHAT LAYOUT === */
  #main-content-area {
      /* Keep original style from Titled wrapper */
      display: flex; flex-direction: column; height: 100dvh; background-color: var(--bg-color); overflow: hidden;
  }
  #chat-container {
      max-width: 900px; margin: 20px auto; padding: 20px; background-color: var(--card-bg);
      border-radius: 12px; box-shadow: 0 2px 8px var(--card-shadow); display: flex; flex-direction: column;
      /* Recalculate max-height carefully. H1 from Titled + NavBar/LogoContainer height */
      /* Inspect element heights for Title H1 and .logo-container */
      max-height: calc(100dvh - 50px - 55px - 20px); /* VP - Approx Title H - Approx Header H - Bottom Margin */
      height: auto; transition: background-color 0.2s, box-shadow 0.2s;
  }
  #chat-messages {
      flex: 1 1 auto; min-height: 100px; overflow-y: auto; padding: 0 15px; margin-bottom: 15px;
      border-radius: 8px; background-color: var(--card-bg); transition: background-color 0.2s, color 0.2s;
      scrollbar-width: thin; scrollbar-color: var(--text-secondary-color) var(--card-bg);
  }
  #chat-messages::-webkit-scrollbar { width: 8px; }
  #chat-messages::-webkit-scrollbar-track { background: var(--card-bg); border-radius: 4px; }
  #chat-messages::-webkit-scrollbar-thumb { background-color: var(--text-secondary-color); border-radius: 4px; border: 2px solid var(--card-bg); }
  
  /* --- Chat Bubbles (Increased Specificity) --- */
  #chat-container .message-container { display: flex; margin: 16px 0; width: 100%; }
  #chat-container .message-container.assistant { justify-content: flex-start; align-items: flex-start !important; gap: 8px; margin: 10px 0; }
  #chat-container .message-container.user { justify-content: flex-end; }
  #chat-container .message-bubble { max-width: 85%; padding: 10px 15px; border-radius: 18px; box-shadow: 0 1px 1px var(--bubble-shadow); transition: background-color 0.2s, color 0.2s, box-shadow 0.2s, border-color 0.2s; border: 1px solid transparent; }
  #chat-container .message-container.assistant .message-bubble { background-color: var(--bubble-bg-assistant); color: var(--bubble-text-assistant); border-top-left-radius: 6px; width: auto; height: min-content; box-sizing: border-box; overflow: hidden; flex-grow: 0; flex-shrink: 1; align-self: flex-start; }
  #chat-container .message-container.assistant .atom-icon { width: 24px; height: 24px; flex-shrink: 0; margin-top: 2px; }
  #chat-container .message-container.user .message-bubble { background-color: var(--bubble-bg-user); color: var(--bubble-text-user); border-top-right-radius: 6px; }
  #chat-container .message-content { white-space: pre-wrap; word-wrap: break-word; line-height: 1.5; max-width: 100%; }
  #chat-container .message-content p { margin: 0; padding: 0; line-height: 1.5; }
  #chat-container .welcome-message-container .message-bubble { height: min-content !important; min-height: unset !important; }
  
  /* Dark Mode Bubble Specificity */
  html[data-theme="dark"] #chat-container .message-container.assistant .message-bubble { background-color: var(--bubble-bg-assistant); color: var(--bubble-text-assistant); border-color: transparent; box-shadow: 0 1px 2px var(--bubble-shadow); }
  html[data-theme="dark"] #chat-container .message-container.user .message-bubble { background-color: var(--bubble-bg-user); color: var(--bubble-text-user); border-color: transparent; box-shadow: 0 1px 2px var(--bubble-shadow); }
  
  /* Specificity for other dark mode elements if needed */
  html[data-theme="dark"] #chat-container { background-color: var(--card-bg); border: 1px solid var(--border-color); box-shadow: 0 2px 8px var(--card-shadow); }
  html[data-theme="dark"] #chat-messages { background-color: var(--card-bg); border: none; }
  html[data-theme="dark"] #chat-form-area { border-top: 1px solid var(--border-color); background-color: var(--card-bg); }
  html[data-theme="dark"] .title-block { background-color: var(--bg-color); border: none; } /* Use body background */
  html[data-theme="dark"] #suggestions-container { background-color: var(--bg-color); border: none; } /* Use body background */
  html[data-theme="dark"] .auto-grow-textarea, html[data-theme="dark"] .suggestion-btn { border-color: var(--border-color); }
  
  
  /* === TITLE AND SUGGESTIONS === */
  /* Add specificity if needed */
  #chat-container .title-block { text-align: center; margin-bottom: 15px; padding: 5px 15px; flex-shrink: 0; background-color: var(--card-bg); transition: background-color 0.2s; }
  #chat-container .page-title { font-size: 1.0rem; color: var(--text-secondary-color); margin: 0; font-weight: bold; font-style: italic; }
  #chat-container #suggestions-container { padding: 0 1rem; text-align: center; margin-bottom: 15px; flex-shrink: 0; background-color: var(--card-bg); transition: background-color 0.2s; }
  #chat-container #suggestions-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; }
  #chat-container .suggestion-btn { display: inline-block; color: var(--button-secondary-text); background-color: var(--button-secondary-bg); margin: 0.4rem; padding: 0.6rem 1rem; border: none; border-radius: 24px; cursor: pointer; font-size: 0.9rem; font-weight: 500; box-shadow: 0 1px 2px var(--shadow-light); transition: background-color 0.2s; }
  #chat-container .suggestion-btn:hover { background-color: var(--button-secondary-hover-bg); }
  #chat-container .suggestions-toggle { background-color: var(--button-secondary-bg); color: var(--button-secondary-text-alt); border: 1px solid var(--border-color); border-radius: 20px; padding: 8px 16px; font-size: 1rem; cursor: pointer; margin: 10px auto; display: none; font-weight: bold; box-shadow: 0 2px 5px var(--shadow-medium); width: 80%; text-align: center; transition: background-color 0.2s, color 0.2s; }
  #chat-container .suggestions-toggle:hover { background-color: var(--button-secondary-hover-bg); }
  
  
  /* === CHAT FORM AREA === */
  /* Add specificity */
  #chat-container #chat-form-area { flex-shrink: 0; padding-top: 10px; padding-bottom: 5px; border-top: 1px solid var(--border-color); transition: border-color 0.2s; position: relative; }
  #chat-container .input-row { position: relative; display: block; margin-bottom: 8px; min-height: 52px; }
  #chat-container .auto-grow-textarea { background-color: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color); width: 100%; box-sizing: border-box; padding: 14px 110px 14px 16px; font-size: 16px; border-radius: 24px; resize: none; outline: none; box-shadow: none; margin: 0; overflow-y: hidden; transition: background-color 0.2s, color 0.2s, border-color 0.2s; }
  #chat-container .auto-grow-textarea::placeholder { color: var(--text-secondary-color); opacity: 0.8; }
  #chat-container .auto-grow-textarea:focus { border-color: var(--primary-accent); box-shadow: 0 0 0 2px rgba(var(--primary-accent), 0.2); }
/* === BUTTONS (Increased Specificity) === */

/* Reset Button */
#chat-form-area .reset-button {
    background-color: var(--button-secondary-bg);
    color: var(--button-secondary-text-alt);
    border: 1px solid var(--border-color);
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    height: 36px;
    line-height: 20px;
    transition: background-color 0.2s, color 0.2s;
    display: inline-block;
    box-shadow: 0 1px 3px var(--shadow-light);
    position: relative;
}
#chat-form-area .reset-button:hover {
    background-color: var(--button-secondary-hover-bg);
}
#chat-form-area .reset-button-container {
    text-align: center;
    margin: 10px auto 5px auto;
    padding: 0;
    width: 100%;
    display: block;
    overflow: visible;
}

/* Run/Stop Button */
#chat-form-area .run-button-base {
    min-width: 100px;
    background-color: var(--primary-accent) !important;
    color: var(--primary-accent-text) !important;
    border: none;
    border-radius: 18px;
    font-weight: 500;
    font-size: 15px;
    cursor: pointer;
    height: 36px;
    text-align: center;
    transition: background-color 0.2s;
    box-sizing: border-box;
    position: absolute;
    right: 6px;
    bottom: 8px;
    transform: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    overflow: hidden;
}
#chat-form-area .run-button-base:hover {
    background-color: var(--primary-accent-hover) !important;
}
#chat-form-area .button-inner-content {
    display: inline-flex; align-items: center; justify-content: center;
    width: 100%; height: 100%; gap: 6px; padding: 0 12px;
}
#chat-form-area .button-text { display: none; }
#chat-form-area .run-text { display: inline; }
#chat-form-area .stop-text { display: none; }
#chat-form-area .button-icon { /* Keep original */ }
#chat-form-area .cmd-icon { display: inline; }

/* Spinner Styles (with specificity) */
#chat-form-area .inline-spinner {
    width: 20px; height: 20px; border-radius: 50%; display: none !important;
    box-sizing: border-box; position: relative; flex-shrink: 0;
    border: 2px solid var(--spinner-on-button-track-color);
    border-top-color: var(--spinner-on-button-color);
    animation: spinner-spin 0.8s linear infinite;
}
#chat-form-area .spinner-square { display: none; }

/* === HTMX/Streaming State Styles (with specificity) === */
#chat-form-area form#chat-form.htmx-request .inline-spinner,
#chat-form-area form.streaming .inline-spinner {
    display: inline-block !important;
}
#chat-form-area form#chat-form.htmx-request .run-text,
#chat-form-area form.streaming .run-text {
    display: none !important;
}
#chat-form-area form#chat-form.htmx-request .cmd-icon,
#chat-form-area form.streaming .cmd-icon {
    display: none !important;
}
#chat-form-area form#chat-form.htmx-request .stop-text,
#chat-form-area form.streaming .stop-text {
    display: inline !important;
}

/* Removed previous #chat-container-based rules for these elements to avoid conflicts */

  
  /* General Content Styling (within chat messages) */
  #chat-messages pre { background-color: var(--code-bg); color: var(--code-text); padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.9rem; margin: 1rem 0; font-family: var(--code-font); }
  #chat-messages code { color: var(--code-text); font-family: var(--code-font); font-size: 0.9em; background-color: var(--code-bg); padding: 0.2em 0.4em; border-radius: 3px; }
  #chat-messages pre code { background-color: transparent; padding: 0; border-radius: 0; font-size: inherit; }
  #chat-messages p { line-height: 1.5; margin: 0.5em 0; color: var(--text-color); } /* Reset default P margin only if needed */
  #chat-messages h1, #chat-messages h2, #chat-messages h3, #chat-messages h4, #chat-messages h5, #chat-messages h6 { color: var(--text-color); margin-top: 1.5rem; margin-bottom: 0.5rem; }
  #chat-messages ul, #chat-messages ol { padding-left: 1.5rem; margin: 0.75rem 0; color: var(--text-color); }
  #chat-messages li { margin-bottom: 0.5rem; }
  #chat-messages table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
  #chat-messages th, #chat-messages td { border: 1px solid var(--table-border-color); padding: 0.5rem; text-align: left; color: var(--text-color); }
  #chat-messages th { background-color: var(--table-header-bg); }
  #chat-messages a { color: var(--link-color); text-decoration: none; }
  #chat-messages a:hover { text-decoration: underline; }
  
  /* === MOBILE RESPONSIVENESS === */
  @media only screen and (max-width: 600px) {
      /* Keep all original mobile styles */
       .header-logo { max-width: 140px; }
       .page-title { font-size: 1.0rem; }
       #chat-container pre { padding: 0.75rem; font-size: 0.8rem; }
       .suggestion-hide-mobile { display: none !important; }
       #chat-container .suggestion-btn { margin: 0.3rem !important; padding: 0.5rem 0.8rem !important; font-size: 0.85rem !important; }
       #chat-container #suggestions-container { padding: 0.3rem !important; margin-bottom: 8px !important; max-height: none !important; overflow-y: visible !important; border-bottom: 1px solid #eee; }
       #chat-container #suggestions-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-top: 10px; transition: max-height 0.3s ease-in-out; }
       #chat-container .suggestions-toggle { display: block !important; width: 80% !important; max-width: 250px !important; margin: 10px auto !important; padding: 8px 16px !important; font-weight: bold !important; font-size: 1rem !important; border-radius: 20px !important; }
       #chat-container .suggestions-collapsed #suggestions-buttons { display: none !important; max-height: 0 !important; overflow: hidden !important; }
       #chat-container .suggestions-collapsed { padding-bottom: 0 !important; border-bottom: none !important; margin-bottom: 0 !important; }
       #chat-container .cmd-icon { display: none; }
  }
  
  /* --- END OF FILE main.css --- */